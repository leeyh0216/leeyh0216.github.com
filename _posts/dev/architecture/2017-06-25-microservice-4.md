---
layout: post
title:  "[MSA] 마이크로 서비스 아키텍쳐- 통합 "
date:   2017-06-25 13:50:00 +0900
author: leeyh0216
categories: dev architecture microservice
---

> 마이크로 서비스 아키텍쳐 구축 4장을 참고하여 작성하였습니다.

## 이상적인 통합 기술 모색

마이크로 서비스 아키텍쳐로 구현된 시스템 내의 서비스들은 각각 독립적인 기능을 수행한다. 하지만 비즈니스 로직은 여러 기능들을 이용하여 하나 이상의 작업을 수행하기 때문에, 이러한 서비스들을 조합하여 사용할 수 있어야 한다.

서비스가 통합되기 위해서는, 서비스 간의 '공유 모델'을 교환할 수 있는 API가 필요하다.

### 호환성을 깨뜨리는 변경 피하기

프로그램 내부에서 일부 클래스의 내부 구현이나 필드 등이 변경이 다른 클래스의 동작에 영향을 미치는 경우가 존재한다.
마이크로 서비스 아키텍쳐에서도 특정 서비스의 내부 변경이 외부 서비스에 영향을 미칠 수 있다.

최대한 내부 구현이 외부 Interface에 영향을 미치도록 해서는 안되며, 내부 구현이 외부 Interface에 영향을 미칠 수 있는 경우라면 기존 사용하던 함수나 서비스를 @Deprecated 처리하고, 새로운 Interface를 만드는 기능을 만들어 해당 서비스나 함수를 이용하는 서비스나 클래스가 바로 영향을 받지 않도록 처리해야 한다.

### 기술 중립적인 API 생성

IT 업계에서는 매년 새로운 기술들이 쏟아져 나온다.
지금 최신 기술을 적용하더라도 1년 후에는 이 기술은 뒤쳐진 기술이 될 수 있다. 서비스 내부에서 사용하는 기술(라이브러리, 프레임워크 등)의 경우에는 내부에서만 영향을 미치므로 큰 관계가 없지만, 서비스 간의 통신을 위해 사용되는 기술은 다르다.

서비스 간의 통신에 사용되는 기술이 변경되는 순간 모든 서비스들의 코드를 변경해야 하는 상황이 오기 때문이다.
따라서 최대한 기술에 영향을 받지 않는 API를 생성하는 것이 중요하다.

### 내부 구현 감추기

서비스의 내부 구현은 다른 서비스에 공개되어서는 안된다. 특정 서비스의 내부 구현에 종속적인 서비스들이 등장하는 순간, 해당 서비스의 구현을 변경할 때 다른 서비스의 구현을 변경해야 하는 경우가 존재하기 때문이다(결합도가 증가한다는 의미와 같다)

## 공유 데이터베이스

일반적으로 시스템 구현 시에 데이터를 공유하기 위해서 공용 데이터베이스를 구축하고, 많은 프로그램들이 이 데이터베이스에 접근하여 데이터를 생성/수정/조회/삭제 하게 된다.
가장 쉬운 방식의 데이터 공유 방식이기는 하지만 여기에는 커다란 단점이 존재한다.

예를 들어 A,B 모듈에서 데이터베이스 내의 특정 테이블을 공유하여 작업을 수행한다고 가정하자.

만일 A 모듈의 기능 추가를 위해 공유 테이블의 특정 필드를 변경한다고 할 때, B 모듈까지 변경되어야 하는 상황이 발생할 수 있다. 이처럼 DB는 사실상 공유 된 매우 큰 API이기 때문에, 상당히 깨지기 쉬운 특성을 가지고 있다.

물론 테스트가 잘 구현된 프로그램의 경우에는 이러한 변화로 인해 특정 모듈에 Side Effect가 존재한다면, 테스트가 실패하여 배포되지 않는 상황이 발생하겠지만, 미연에 이를 방지해야 한다.

이와 같이 데이터베이스를 공유하게 되는 순간 모든 모듈이나 서비스들은 데이터베이스에 대한 결합도가 높아지는 현상이 발생하게 된다. 물론 쉽게 데이터를 공유할 수 있다는 장점은 존재하지만, 변경에 대한 대응이 취약해질 수 있다.

이런 방식은 피해야 한다.

