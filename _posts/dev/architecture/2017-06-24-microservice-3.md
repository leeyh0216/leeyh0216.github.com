---
layout: post
title:  "[MSA] 마이크로 서비스 아키텍쳐 - 서비스 모델링"
date:   2017-06-24 21:45:00 +0900
author: leeyh0216
categories: dev architecture microservice
---

> 마이크로 서비스 아키텍쳐 구축 3장을 공부하며 작성한 글입니다.

## 무엇이 좋은 서비스를 만드는가?

### 느슨한 결합

서비스가 느슨한 결합의 형태를 취하고 있다면, 하나의 서비스가 바뀌어도 다른 서비스가 영향을 미치는 일이 없다.
마이크로 서비스 아키텍쳐는 서비스간의 느슨한 결합을 지향하고 있기 때문에, 특정 서비스를 변경하고 배포하는데에 큰 어려움이 없다.

객체지향 설계에서도 느슨한 결합은 중요하다. 이러한 관점이 시스템 레벨인에서의 적용인가 코드 레벨에서의 적용인가가 둘의 차이를 유발한다.

일반적으로 회사 업무를 하며 코드에 대한 문서화(ex. javadoc 또는 wiki 정리) 등이 잘 이루어지지 않고, 서로의 코드를 확인할 수 있기 때문에 다른 사람의 코드에 내 코드를 맞추는 경우가 많다.
정확한 API가 정의되어 있다면, 내부 구현에 대한 이해도가 없어도 작업이 가능하기 때문에, 모듈 간의 의존성이 줄어들게 된다.

서비스 관점에서 보아도 이는 동일하다. 각 서비스가 신뢰할 수 있고 문서화가 잘 되어 있다면, 서로에게 의존하지 않고 개별 서비스를 작성할 수 있다.

만일 서비스 간에 강한 결합을 가지고 있다면, 참조하고 있는 서비스가 변경되는 순간 내 서비스도 동작하지 않는다는 것을 알게되고, 코드는 더 이상 발전하지 않을 것이다.

### 강한 응집력

코드 레벨에서는 '클래스'라는 단위로 연관된 행위를 묶어놓는다. 마이크로 서비스 아키텍쳐에서는 '서비스' 라는 단위로 연관된 행위를 묶어놓게 된다. 너무 작은 단위로 이루어진 서비스는 너무 잦은 릴리즈와 파편화를 야기할 수 있다.

### 정리
위 두 속성을 조화롭게 이행하기 위해서는, '서비스'를 나누는 적당한 경계를 나눌 수 있어야 한다.

## 경계가 있는 콘텍스트

### 감춰진 공유 모델

예를 들어 Sqoop(http://sqoop.apache.org/) 과 Hive(http://hive.apache.org/)를 이용하여 데이터를 수집하고, 사용자에게 분석을 위한 DB를 제공하는 시스템을 만든다고 가정하자.

Sqoop은 RDBMS 데이터를 수집하여 HDFS 등으로 적재할 수 있는 Apache Open Source Project이고, Hive는 HDFS에 적재 된 데이터베이스를 SQL 형식으로 조회 할 수 있는 Apache Open Source Project이다.

Sqoop이 가동되기 위해서는, 수집 대상 데이터베이스의 정보(IP, Port, DB Category, Id, Password)와 수집 대상 테이블 정보(Table Name, Query), 수집된 데이터의 적재 경로(Hadoop Directory or Local Directory) 등을 알아야 한다.

Hive가 가동되기 위해서는 데이터의 경로와 생성할 데이터베이스명, 테이블명, 데이터의 구조 등을 알아야 한다.

두 서비스를 결합하여 사용한다고 할 때, Hive 입장에서는 Sqoop 작업이 수집한 데이터를 적재한 경로, 수집한 데이터의 구조를 알아야 한다.

마이크로 서비스 아키텍쳐에서 두 서비스의 경계에서 공유되어야 하는 부분을 '공유 모델' 이라고 지칭한다.
'공유 모델'은 작은 정보만을 가지고 있어야 한다. 너무 많은 내용을 공유하게 되면 다른 서비스가 불필요한 정보들에도 의존하게 되고, 이는 강한 결합성을 가지게 되기 때문이다.

### 모듈과 서비스

서비스 설계 시에 어떤 정보를 공유해야 하는지, 어떤 정보를 공유하면 안되는지 고려하므로써 강한 결합을 초래하는 함정을 회피할 수 있다.

이러한 부분은 코드 레벨에서도 진행할 수 있다(객체지향 설계의 '캡슐화'). 코드 레벨에서 이러한 결합도를 낮추게 되면, 추후 해당 코드로 구성된 '클래스' 또는 '모듈'을 서비스로 분리하기 편해진다.

무작정 '서비스' 레벨로 분리하다 보면, 서비스 경계를 잘못 설정하여 추후 재정비에 큰 비용이 들 수 있으므로 초기에는 코드 레벨로 분리 후에 마이크로 서비스 아키텍쳐에 익숙해진 후 '서비스' 레벨로 분리할 수 있게 된다.

### 정리

성급한 '서비스'로의 분리보다는 객체 수준에서의 분리를 수행한 후, 마이크로 서비스 아키텍쳐로의 이동을 택하는 편이 좋을 것이라는 생각이 든다.

설계 후 코드 작업이 시작되면, 다시 설계를 하는 부분으로 돌아가는 것이 힘들어질 수 있으므로(물론 조직 규모가 작거나, 애자일에 대한 이해도가 높은 회사라면 말이 달라지겠지만, 대부분의 회사가 프로젝트 초반 설계를 마지막까지 그대로 가져가는 경우가 많기 때문에 이러한 상황이 발생한다고 생각한다) 코드 레벨 분리 후 프로토 타이핑을 통하여 작은 서비스로 나누는 것도 나쁘지 않다고 생각한다.